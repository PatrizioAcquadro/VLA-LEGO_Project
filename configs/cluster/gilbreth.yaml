# Cluster Configuration: Gilbreth (Purdue)
# Hardware-specific settings for optimal performance

name: gilbreth

# ============================================================================
# Hardware
# ============================================================================
hardware:
  accelerator: "gpu"
  gpu_type: "a100_80gb"
  gpus_per_node: 2
  
  # Memory
  gpu_memory_gb: 80
  cpu_memory_gb: 512
  
  # Interconnect
  interconnect: "infiniband"  # 100 Gbps

# ============================================================================
# Distributed Training
# ============================================================================
distributed:
  backend: "nccl"
  
  # DeepSpeed ZeRO configuration
  deepspeed:
    enabled: true
    stage: 1  # ZeRO-1 (optimizer state partitioning)
    
    # ZeRO-1 specific
    reduce_bucket_size: 500000000  # 500M parameters per bucket
    allgather_bucket_size: 500000000
    
    # Communication optimization
    overlap_comm: true
    contiguous_gradients: true

# ============================================================================
# NCCL Settings
# ============================================================================
nccl:
  debug: "INFO"  # Set to "WARN" in production
  ib_disable: 0  # Enable InfiniBand
  socket_ifname: "ib0"  # InfiniBand interface
  
  # Timeout (increase for large models)
  timeout_minutes: 30

# ============================================================================
# SLURM Settings
# ============================================================================
slurm:
  account: "euge-k"
  partition: "a100-80gb"
  qos: "normal"  # or "standby" for testing
  
  # Default resource requests
  nodes: 1
  gpus_per_node: 2
  cpus_per_task: 16
  mem_gb: 200
  time_limit: "24:00:00"

# ============================================================================
# Paths (cluster-specific)
# ============================================================================
cluster_paths:
  scratch: "/scratch/gilbreth/${oc.env:USER}"
  home: "/home/${oc.env:USER}"
  
  # Use scratch for large files
  checkpoints: "${cluster_paths.scratch}/worldsim/checkpoints"
  logs: "${cluster_paths.scratch}/worldsim/logs"
  cache: "${cluster_paths.scratch}/worldsim/cache"

# ============================================================================
# Environment Modules
# ============================================================================
modules:
  - "anaconda/2024.02"
  # Add more as discovered
